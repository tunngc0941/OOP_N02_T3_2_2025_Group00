<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>üí∞ Qu·∫£n l√Ω Giao d·ªãch - Shop Gi√†y THN</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f7f5f2;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .navbar-custom {
        background-color: #2c3e50;
      }
      .navbar-custom .nav-link,
      .navbar-custom .navbar-brand {
        color: #ecf0f1;
        font-weight: 600;
      }
      .navbar-custom .nav-link:hover {
        color: #f39c12;
      }
      header {
        background: url('https://images.unsplash.com/photo-1576491110919-df70d852860f?q=80&w=1172&auto=format&fit=crop')
          center/cover no-repeat;
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
      }
      header h1 {
        font-size: 3rem;
        background: rgba(44, 62, 80, 0.7);
        padding: 15px 30px;
        border-radius: 12px;
      }
      .table-img {
        width: 60px;
        height: 40px;
        object-fit: contain;
        border-radius: 4px;
      }
      .form-control-sm {
        max-width: 150px;
      }
      .btn-sm {
        min-width: 70px;
      }
      .section-title {
        margin-top: 30px;
        margin-bottom: 20px;
        font-weight: 700;
        color: #34495e;
      }
      footer {
        margin-top: 60px;
        background: #2c3e50;
        color: #bdc3c7;
        padding: 15px 0;
        text-align: center;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container">
        <a class="navbar-brand" href="#">üè† Shop Gi√†y THN</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navMain"
        >
          <span class="navbar-toggler-icon"
            ><i class="bi bi-list" style="font-size: 1.5rem; color: #ecf0f1"></i
          ></span>
        </button>
        <div class="collapse navbar-collapse" id="navMain">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="/main">Trang ch·ªß</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/sanpham">S·∫£n ph·∫©m</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/khachhang">Kh√°ch h√†ng</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/giaodich">Giao d·ªãch</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Banner -->
    <header>
      <h1>Qu·∫£n l√Ω Giao d·ªãch</h1>
    </header>

    <!-- Main content -->
    <main class="container my-4">
      <h2 class="section-title text-center">Danh s√°ch Giao d·ªãch</h2>

      <!-- Search & Add -->
      <div
        class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2"
      >
        <input
          type="text"
          id="searchInput"
          placeholder="T√¨m theo m√£ GD, t√™n KH ho·∫∑c s·∫£n ph·∫©m..."
          class="form-control form-control-sm"
          style="max-width: 300px"
        />
        <button
          class="btn btn-success btn-sm"
          data-bs-toggle="modal"
          data-bs-target="#transactionModal"
          id="btnAddTransaction"
        >
          <i class="bi bi-plus-lg"></i> Th√™m giao d·ªãch
        </button>
      </div>

      <!-- Table giao d·ªãch -->
      <div class="table-responsive mb-4">
        <table class="table table-striped table-bordered align-middle">
          <thead class="table-dark">
            <tr>
              <th>M√£ GD</th>
              <th>Ng√†y</th>
              <th>Kh√°ch h√†ng</th>
              <th>S·∫£n ph·∫©m</th>
              <th>S·ªë l∆∞·ª£ng</th>
              <th>Th√†nh ti·ªÅn</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="transaction-list">
            <!-- D·ªØ li·ªáu giao d·ªãch s·∫Ω load v√†o ƒë√¢y -->
          </tbody>
        </table>
      </div>

      <!-- Th·ªëng k√™ -->
      <div class="card p-3 mb-4 shadow-sm">
        <h4 class="mb-3">Th·ªëng k√™</h4>
        <div class="row">
          <div class="col-md-4">
            <div class="card bg-primary text-white p-3">
              <h5 class="card-title">T·ªïng giao d·ªãch</h5>
              <h3 id="totalTransactions" class="card-text">0</h3>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card bg-success text-white p-3">
              <h5 class="card-title">T·ªïng doanh thu</h5>
              <h3 id="totalRevenue" class="card-text">0 ‚Ç´</h3>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card bg-info text-white p-3">
              <h5 class="card-title">T·ªïng s·∫£n ph·∫©m ƒë√£ b√°n</h5>
              <h3 id="totalProductsSold" class="card-text">0</h3>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Modal th√™m/s·ª≠a giao d·ªãch -->
    <div
      class="modal fade"
      id="transactionModal"
      tabindex="-1"
      aria-labelledby="transactionModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <form id="transactionForm" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="transactionModalLabel">Th√™m giao d·ªãch</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="ƒê√≥ng"
            ></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="originalMaGd" />
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="maGd" class="form-label">M√£ giao d·ªãch</label>
                <input
                  type="text"
                  class="form-control"
                  id="maGd"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label for="ngayGd" class="form-label">Ng√†y giao d·ªãch</label>
                <input
                  type="date"
                  class="form-control"
                  id="ngayGd"
                  required
                />
              </div>
            </div>
            <div class="mb-3">
              <label for="khachHang" class="form-label">Kh√°ch h√†ng</label>
              <select class="form-select" id="khachHang" required>
                <option value="">Ch·ªçn kh√°ch h√†ng</option>
                <!-- Options s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">S·∫£n ph·∫©m</label>
              <div class="table-responsive">
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>S·∫£n ph·∫©m</th>
                      <th>Gi√°</th>
                      <th>S·ªë l∆∞·ª£ng</th>
                      <th>Th√†nh ti·ªÅn</th>
                      <th>H√†nh ƒë·ªông</th>
                    </tr>
                  </thead>
                  <tbody id="productItems">
                    <!-- S·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                  </tbody>
                  <tfoot>
                    <tr>
                      <td colspan="3" class="text-end fw-bold">T·ªïng c·ªông:</td>
                      <td id="totalAmount" class="fw-bold">0 ‚Ç´</td>
                      <td></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
              <div class="d-flex gap-2 mt-2">
                <select class="form-select" id="productSelect">
                  <option value="">Ch·ªçn s·∫£n ph·∫©m</option>
                  <!-- Options s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
                </select>
                <input
                  type="number"
                  id="productQuantity"
                  class="form-control"
                  placeholder="S·ªë l∆∞·ª£ng"
                  min="1"
                  style="width: 100px"
                />
                <button
                  type="button"
                  class="btn btn-primary btn-sm"
                  id="btnAddProduct"
                >
                  Th√™m
                </button>
              </div>
            </div>
            <div
              id="formAlert"
              class="alert alert-danger d-none"
              role="alert"
            ></div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary btn-sm"
              data-bs-dismiss="modal"
            >
              H·ªßy
            </button>
            <button type="submit" class="btn btn-primary btn-sm">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>

    <footer>&copy; 2025 Shop Gi√†y THN - H·ªá th·ªëng qu·∫£n l√Ω b√°n h√†ng</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // DOM Elements
      const transactionList = document.getElementById('transaction-list');
      const searchInput = document.getElementById('searchInput');
      const btnAddTransaction = document.getElementById('btnAddTransaction');
      const transactionModal = new bootstrap.Modal(
        document.getElementById('transactionModal')
      );
      const transactionForm = document.getElementById('transactionForm');
      const formAlert = document.getElementById('formAlert');
      const originalMaGd = document.getElementById('originalMaGd');
      const maGdInput = document.getElementById('maGd');
      const ngayGdInput = document.getElementById('ngayGd');
      const khachHangSelect = document.getElementById('khachHang');
      const productSelect = document.getElementById('productSelect');
      const productQuantity = document.getElementById('productQuantity');
      const btnAddProduct = document.getElementById('btnAddProduct');
      const productItems = document.getElementById('productItems');
      const totalAmount = document.getElementById('totalAmount');

      // Stats elements
      const totalTransactionsEl = document.getElementById('totalTransactions');
      const totalRevenueEl = document.getElementById('totalRevenue');
      const totalProductsSoldEl = document.getElementById('totalProductsSold');

      // Data
      let giaoDichData = JSON.parse(localStorage.getItem('giaoDichData')) || [];
      let khachHangData =
        JSON.parse(localStorage.getItem('khachHangData')) ||
        [
          { ten: 'Ho√†ng VƒÉn V·ªü', sdt: '0912345678' },
          { ten: 'Ho√†ng Minh Th√°i', sdt: '0987654321' },
          { ten: 'Ho√†ng Nh·∫≠t B·∫£o Tr√¢m', sdt: '0905123456' },
          { ten: 'Ho√†ng Quang L√¢m', sdt: '0933344455' },
          { ten: 'Nguy·ªÖn VƒÉn H√†o', sdt: '0354622898' },
          { ten: 'Ng√¥ ƒê·ª©c Khang', sdt: '0972539940' },
        ];
      let sanPhamData =
        JSON.parse(localStorage.getItem('sanPhamData')) ||
        [
          {
          maSp: 'SP001',
          name: 'Gi√†y Sneaker Nam Tr·∫Øng',
          price: 650000,
          size: 42,
          imageURL: 'data:image/jpeg;base64,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',
          },
          {
          maSp: 'SP002',
          name: 'Gi√†y Th·ªÉ Thao N·ªØ H·ªìng',
          price: 720000,
          size: 38,
          imageURL: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxISEhUQEhIWExUWExUXFhUYGBoYFxUXGBUXFhgdFxYYICggGR0xGxMVITUhJSkrLi4uGB8zODMsNygtLi0BCgoKDg0OFxAQGy0fICUtLS03LS0tKy01Ly0tLS0tLS8rLS0tLS0tLi8rLS0rLy0tKy0tLS4tLS0tLSstLS0tLf/AABEIAOEA4QMBIgACEQEDEQH/xAAcAAEAAgMBAQEAAAAAAAAAAAAAAwUCBAYBBwj/xABDEAABAwIDBQUGAwUGBgMAAAABAAIRAyEEMUEFElFhcSKBkaHwBgcTMkKxUsHRM2Jy4fEUgpKissLxFhclY+IV/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAGxEBAQEBAAMBAAAAAAAAAAAAABEBEiExQQL/2gAMAwEAAhEDEQA/APuKIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIgIiICIiAiIg/9k=',
          },
          {
          maSp: 'SP003',
          name: 'Gi√†y ƒê√° Banh Nike',
          price: 1250000,
          size: 43,
          imageURL: 'https://images.unsplash.com/photo-1664754978480-82ac6ab992c1?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8c2hvZXMlMjBuaWtlJTIwc29jY2VyfGVufDB8fDB8fHww',
          },
          {
          maSp: 'SP004',
          name: 'Gi√†y T√¢y Da ƒêen',
          price: 890000,
          size: 41,
          imageURL: 'data:image/jpeg;base64,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',
          },
          {
          maSp: 'SP005',
          name: 'Gi√†y Th·ªÉ Thao Nam',
          price: 850000,
          size: 41,
          imageURL: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=400&q=80',
          },
          {
          maSp: 'SP006',
          name: 'Gi√†y Th·ªÉ Thao N·ªØ',
          price: 850000,
          size: 39,
          imageURL: 'https://images.unsplash.com/photo-1511556532299-8f662fc26c06?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
          },
        ];

      // Current transaction items
      let currentItems = [];

      // H√†m l∆∞u d·ªØ li·ªáu v√†o localStorage
      function saveData() {
        localStorage.setItem('giaoDichData', JSON.stringify(giaoDichData));
      }

      // Load d·ªØ li·ªáu kh√°ch h√†ng v√†o select
      function loadKhachHangOptions() {
        khachHangSelect.innerHTML = '<option value="">Ch·ªçn kh√°ch h√†ng</option>';
        khachHangData.forEach((kh) => {
          khachHangSelect.innerHTML += `<option value="${kh.sdt}">${kh.ten} (${kh.sdt})</option>`;
        });
      }

      // Load d·ªØ li·ªáu s·∫£n ph·∫©m v√†o select
      function loadSanPhamOptions() {
        productSelect.innerHTML = '<option value="">Ch·ªçn s·∫£n ph·∫©m</option>';
        sanPhamData.forEach((sp) => {
          productSelect.innerHTML += `<option value="${sp.maSp}">${sp.name} - ${sp.price.toLocaleString('vi-VN')} ‚Ç´</option>`;
        });
      }

      // Hi·ªÉn th·ªã danh s√°ch giao d·ªãch
      function loadGiaoDich() {
        transactionList.innerHTML = '';
        if (giaoDichData.length === 0) {
          transactionList.innerHTML = `<tr><td colspan="7" class="text-center">Ch∆∞a c√≥ giao d·ªãch n√†o.</td></tr>`;
          updateStats();
          return;
        }

        giaoDichData.forEach((gd) => {
          let productsHtml = '';
          gd.sanPham.forEach((sp) => {
            const product = sanPhamData.find((p) => p.maSp === sp.maSp);
            productsHtml += `
              <div class="d-flex align-items-center mb-1">
                <img src="${
                  product?.imageURL ||
                  'https://via.placeholder.com/60x40?text=No+Image'
                }" alt="${product?.name || sp.maSp}" class="table-img me-2">
                <div>
                  <div>${product?.name || sp.maSp}</div>
                  <small class="text-muted">${sp.soLuong} x ${sp.donGia.toLocaleString('vi-VN')} ‚Ç´</small>
                </div>
              </div>
            `;
          });

          const khachHang = khachHangData.find((kh) => kh.sdt === gd.sdtKhachHang);

          transactionList.innerHTML += `
            <tr>
              <td>${gd.maGd}</td>
              <td>${new Date(gd.ngayGd).toLocaleDateString('vi-VN')}</td>
              <td>${khachHang?.ten || 'Kh√°ch l·∫ª'} (${gd.sdtKhachHang})</td>
              <td>${productsHtml}</td>
              <td>${gd.sanPham.reduce(
                (total, sp) => total + sp.soLuong,
                0
              )}</td>
              <td>${gd.tongTien.toLocaleString('vi-VN')} ‚Ç´</td>
              <td>
                <button class="btn btn-sm btn-warning me-1" onclick="editGiaoDich('${
                  gd.maGd
                }')">
                  <i class="bi bi-pencil-fill"></i> S·ª≠a
                </button>
                <button class="btn btn-sm btn-danger me-1" onclick="deleteGiaoDich('${
                  gd.maGd
                }')">
                  <i class="bi bi-trash-fill"></i> X√≥a
                </button>
                <!-- Th√™m n√∫t In -->
                <button class="btn btn-sm btn-secondary" onclick="printGiaoDich('${
                  gd.maGd
                }')">
                  <i class="bi bi-printer-fill"></i> In
                </button>
              </td>
            </tr>
          `;
        });

        updateStats();
      }

      // C·∫≠p nh·∫≠t th·ªëng k√™
      function updateStats() {
        totalTransactionsEl.textContent = giaoDichData.length;
        const revenue = giaoDichData.reduce(
          (total, gd) => total + gd.tongTien,
          0
        );
        totalRevenueEl.textContent = revenue.toLocaleString('vi-VN') + ' ‚Ç´';
        const productsSold = giaoDichData.reduce(
          (total, gd) =>
            total + gd.sanPham.reduce((sum, sp) => sum + sp.soLuong, 0),
          0
        );
        totalProductsSoldEl.textContent = productsSold;
      }

      // T√≠nh t·ªïng ti·ªÅn cho c√°c s·∫£n ph·∫©m hi·ªán t·∫°i
      function calculateTotal() {
        const total = currentItems.reduce(
          (sum, item) => sum + item.donGia * item.soLuong,
          0
        );
        totalAmount.textContent = total.toLocaleString('vi-VN') + ' ‚Ç´';
        return total;
      }

      // Hi·ªÉn th·ªã s·∫£n ph·∫©m ƒë√£ ch·ªçn
      function renderSelectedProducts() {
        productItems.innerHTML = '';
        currentItems.forEach((item, index) => {
          const product = sanPhamData.find((p) => p.maSp === item.maSp);
          productItems.innerHTML += `
            <tr>
              <td>${product?.name || item.maSp}</td>
              <td>${item.donGia.toLocaleString('vi-VN')} ‚Ç´</td>
              <td>
                <input type="number" class="form-control form-control-sm quantity-input" 
                  value="${item.soLuong}" min="1" data-index="${index}">
              </td>
              <td>${(item.donGia * item.soLuong).toLocaleString('vi-VN')} ‚Ç´</td>
              <td>
                <button class="btn btn-sm btn-danger" onclick="removeProductItem(${index})">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
          `;
        });

        // Th√™m s·ª± ki·ªán thay ƒë·ªïi s·ªë l∆∞·ª£ng
        document.querySelectorAll('.quantity-input').forEach((input) => {
          input.addEventListener('change', (e) => {
            const index = parseInt(e.target.dataset.index);
            currentItems[index].soLuong = parseInt(e.target.value);
            calculateTotal();
            renderSelectedProducts();
          });
        });

        calculateTotal();
      }

      // X√≥a s·∫£n ph·∫©m kh·ªèi danh s√°ch
      window.removeProductItem = function (index) {
        currentItems.splice(index, 1);
        renderSelectedProducts();
      };

      // Th√™m s·∫£n ph·∫©m v√†o danh s√°ch
      btnAddProduct.addEventListener('click', () => {
        const maSp = productSelect.value;
        const quantity = parseInt(productQuantity.value) || 1;

        if (!maSp) {
          alert('Vui l√≤ng ch·ªçn s·∫£n ph·∫©m');
          return;
        }

        if (quantity < 1) {
          alert('S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0');
          return;
        }

        const product = sanPhamData.find((p) => p.maSp === maSp);
        if (!product) {
          alert('S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i');
          return;
        }

        // Ki·ªÉm tra n·∫øu s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i th√¨ c·ªông th√™m s·ªë l∆∞·ª£ng
        const existingItem = currentItems.find((item) => item.maSp === maSp);
        if (existingItem) {
          existingItem.soLuong += quantity;
        } else {
          currentItems.push({
            maSp: product.maSp,
            donGia: product.price,
            soLuong: quantity,
          });
        }

        productSelect.value = '';
        productQuantity.value = '';
        renderSelectedProducts();
      });

      // T√¨m ki·∫øm giao d·ªãch
      searchInput.addEventListener('input', () => {
        const keyword = searchInput.value.toLowerCase();
        const filtered = giaoDichData.filter((gd) => {
          const khachHang = khachHangData.find((kh) => kh.sdt === gd.sdtKhachHang);
          const khachHangText = khachHang
            ? `${khachHang.ten} ${khachHang.sdt}`.toLowerCase()
            : '';
          
          const sanPhamText = gd.sanPham
            .map((sp) => {
              const product = sanPhamData.find((p) => p.maSp === sp.maSp);
              return product ? product.name.toLowerCase() : sp.maSp.toLowerCase();
            })
            .join(' ');
          
          return (
            gd.maGd.toLowerCase().includes(keyword) ||
            khachHangText.includes(keyword) ||
            sanPhamText.includes(keyword)
          );
        });
        
        // Hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm
        if (filtered.length === 0) {
          transactionList.innerHTML = `<tr><td colspan="7" class="text-center">Kh√¥ng t√¨m th·∫•y giao d·ªãch ph√π h·ª£p.</td></tr>`;
        } else {
          // C·∫≠p nh·∫≠t l·∫°i danh s√°ch v·ªõi k·∫øt qu·∫£ t√¨m ki·∫øm
          transactionList.innerHTML = '';
          filtered.forEach((gd) => {
            let productsHtml = '';
            gd.sanPham.forEach((sp) => {
              const product = sanPhamData.find((p) => p.maSp === sp.maSp);
              productsHtml += `
                <div class="d-flex align-items-center mb-1">
                  <img src="${
                    product?.imageURL ||
                    'https://via.placeholder.com/60x40?text=No+Image'
                  }" alt="${product?.name || sp.maSp}" class="table-img me-2">
                  <div>
                    <div>${product?.name || sp.maSp}</div>
                    <small class="text-muted">${sp.soLuong} x ${sp.donGia.toLocaleString('vi-VN')} ‚Ç´</small>
                  </div>
                </div>
              `;
            });

            const khachHang = khachHangData.find((kh) => kh.sdt === gd.sdtKhachHang);

            transactionList.innerHTML += `
              <tr>
                <td>${gd.maGd}</td>
                <td>${new Date(gd.ngayGd).toLocaleDateString('vi-VN')}</td>
                <td>${khachHang?.ten || 'Kh√°ch l·∫ª'} (${gd.sdtKhachHang})</td>
                <td>${productsHtml}</td>
                <td>${gd.sanPham.reduce(
                  (total, sp) => total + sp.soLuong,
                  0
                )}</td>
                <td>${gd.tongTien.toLocaleString('vi-VN')} ‚Ç´</td>
                <td>
                  <button class="btn btn-sm btn-warning me-1" onclick="editGiaoDich('${
                    gd.maGd
                  }')">
                    <i class="bi bi-pencil-fill"></i> S·ª≠a
                  </button>
                  <button class="btn btn-sm btn-danger me-1" onclick="deleteGiaoDich('${
                    gd.maGd
                  }')">
                    <i class="bi bi-trash-fill"></i> X√≥a
                  </button>
                  <!-- Th√™m n√∫t In cho k·∫øt qu·∫£ t√¨m ki·∫øm -->
                  <button class="btn btn-sm btn-secondary" onclick="printGiaoDich('${
                    gd.maGd
                  }')">
                    <i class="bi bi-printer-fill"></i> In
                  </button>
                </td>
              </tr>
            `;
          });
        }
      });

      // M·ªü modal th√™m giao d·ªãch m·ªõi
      btnAddTransaction.addEventListener('click', () => {
        transactionForm.reset();
        formAlert.classList.add('d-none');
        document.querySelector('#transactionModal .modal-title').textContent =
          'Th√™m giao d·ªãch';
        originalMaGd.value = '';
        currentItems = [];
        renderSelectedProducts();
        maGdInput.disabled = false;
        // Set ng√†y m·∫∑c ƒë·ªãnh l√† h√¥m nay
        ngayGdInput.valueAsDate = new Date();
      });

      // S·ª≠a giao d·ªãch
      window.editGiaoDich = function (maGd) {
        formAlert.classList.add('d-none');
        const gd = giaoDichData.find((g) => g.maGd === maGd);
        if (!gd) return alert('Kh√¥ng t√¨m th·∫•y giao d·ªãch!');
        
        document.querySelector('#transactionModal .modal-title').textContent =
          'S·ª≠a giao d·ªãch';
        originalMaGd.value = gd.maGd;
        maGdInput.value = gd.maGd;
        ngayGdInput.value = new Date(gd.ngayGd).toISOString().split('T')[0];
        khachHangSelect.value = gd.sdtKhachHang;
        currentItems = [...gd.sanPham];
        renderSelectedProducts();
        maGdInput.disabled = true;
        transactionModal.show();
      };

      // X√≥a giao d·ªãch
      window.deleteGiaoDich = function (maGd) {
        if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a giao d·ªãch ${maGd} kh√¥ng?`)) return;
        giaoDichData = giaoDichData.filter((g) => g.maGd !== maGd);
        saveData();
        loadGiaoDich();
      };

      // X·ª≠ l√Ω submit form
      transactionForm.addEventListener('submit', (e) => {
        e.preventDefault();
        formAlert.classList.add('d-none');
        
        const maGd = maGdInput.value.trim();
        const ngayGd = ngayGdInput.value;
        const sdtKhachHang = khachHangSelect.value.trim();
        
        if (!maGd || !ngayGd || !sdtKhachHang) {
          formAlert.textContent = 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin giao d·ªãch.';
          formAlert.classList.remove('d-none');
          return;
        }
        
        if (currentItems.length === 0) {
          formAlert.textContent = 'Vui l√≤ng th√™m √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m.';
          formAlert.classList.remove('d-none');
          return;
        }
        
        const tongTien = calculateTotal();
        const payload = {
          maGd,
          ngayGd: new Date(ngayGd).toISOString(),
          sdtKhachHang,
          sanPham: currentItems,
          tongTien,
        };
        
        if (originalMaGd.value) {
          // C·∫≠p nh·∫≠t
          const index = giaoDichData.findIndex((g) => g.maGd === originalMaGd.value);
          if (index !== -1) giaoDichData[index] = payload;
          alert('C·∫≠p nh·∫≠t giao d·ªãch th√†nh c√¥ng');
        } else {
          // Th√™m m·ªõi
          // Ki·ªÉm tra m√£ GD tr√πng
          if (giaoDichData.some((g) => g.maGd === maGd)) {
            formAlert.textContent = 'M√£ giao d·ªãch ƒë√£ t·ªìn t·∫°i.';
            formAlert.classList.remove('d-none');
            return;
          }
          giaoDichData.push(payload);
          alert('Th√™m giao d·ªãch th√†nh c√¥ng');
        }
        
        saveData();
        transactionModal.hide();
        loadGiaoDich();
      });

      // Kh·ªüi t·∫°o
      loadKhachHangOptions();
      loadSanPhamOptions();
      loadGiaoDich();

      // H√†m in giao d·ªãch (m·ªü c·ª≠a s·ªï in h√≥a ƒë∆°n)
      window.printGiaoDich = function (maGd) {
        const gd = giaoDichData.find((g) => g.maGd === maGd);
        if (!gd) return alert('Kh√¥ng t√¨m th·∫•y giao d·ªãch ƒë·ªÉ in.');

        const kh = khachHangData.find((k) => k.sdt === gd.sdtKhachHang);
        const ngay = new Date(gd.ngayGd).toLocaleDateString('vi-VN');
        const sanPhamHtml = gd.sanPham
          .map((item) => {
            const p = sanPhamData.find((s) => s.maSp === item.maSp) || {};
            const name = p.name || item.maSp;
            const donGia = (item.donGia || 0).toLocaleString('vi-VN') + ' ‚Ç´';
            const thanhTien = ((item.donGia || 0) * (item.soLuong || 0)).toLocaleString('vi-VN') + ' ‚Ç´';
            return `
              <tr>
                <td>${name}</td>
                <td class="text-end">${donGia}</td>
                <td class="text-center">${item.soLuong}</td>
                <td class="text-end">${thanhTien}</td>
              </tr>
            `;
          })
          .join('');

        const total = gd.tongTien ? gd.tongTien.toLocaleString('vi-VN') + ' ‚Ç´' : calculateTotalFor(gd).toLocaleString('vi-VN') + ' ‚Ç´';

        const printHtml = `
          <!doctype html>
          <html>
            <head>
              <meta charset="utf-8"/>
              <title>H√≥a ƒë∆°n ${gd.maGd}</title>
              <style>
                body { font-family: Arial, sans-serif; color: #222; padding: 20px; }
                .header { text-align: center; margin-bottom: 12px; }
                .company { font-size: 18px; font-weight: 700; }
                .small { font-size: 12px; color: #555; }
                table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                th, td { border: 1px solid #ccc; padding: 8px; }
                th { background: #f5f5f5; }
                .text-end { text-align: right; }
                .text-center { text-align: center; }
                .summary { margin-top: 12px; width: 100%; }
                .summary td { border: none; padding: 6px; }
                @media print {
                  button { display: none; }
                }
              </style>
            </head>
            <body>
              <div class="header">
                <div class="company">Shop Gi√†y THN</div>
                <div class="small">ƒê·ªãa ch·ªâ: (th√™m n·∫øu c·∫ßn) ‚Ä¢ ƒêi·ªán tho·∫°i: (th√™m n·∫øu c·∫ßn)</div>
              </div>

              <div>
                <strong>M√£ GD:</strong> ${gd.maGd} <br/>
                <strong>Ng√†y:</strong> ${ngay} <br/>
                <strong>Kh√°ch h√†ng:</strong> ${kh ? kh.ten + ' (' + kh.sdt + ')' : 'Kh√°ch l·∫ª (' + gd.sdtKhachHang + ')'} 
              </div>

              <table>
                <thead>
                  <tr>
                    <th>S·∫£n ph·∫©m</th>
                    <th style="width:120px;">ƒê∆°n gi√°</th>
                    <th style="width:80px;">S·ªë l∆∞·ª£ng</th>
                    <th style="width:140px;">Th√†nh ti·ªÅn</th>
                  </tr>
                </thead>
                <tbody>
                  ${sanPhamHtml}
                </tbody>
              </table>

              <table class="summary">
                <tr>
                  <td style="text-align:right; font-weight:700;">T·ªïng c·ªông:</td>
                  <td style="width:150px; text-align:right; font-weight:700;">${total}</td>
                </tr>
              </table>

              <div style="margin-top:24px;">
                <em>Ng∆∞·ªùi l·∫≠p: ____________________</em>
              </div>

              <script>
                window.onload = function() {
                  window.print();
                  // Uncomment ƒë·ªÉ t·ª± ƒë√≥ng c·ª≠a s·ªï sau in
                  // setTimeout(() => window.close(), 500);
                };
              <\/script>
            </body>
          </html>
        `;

        const w = window.open('', '_blank', 'width=800,height=900');
        w.document.open();
        w.document.write(printHtml);
        w.document.close();
      };

      // N·∫øu giao d·ªãch ch∆∞a c√≥ tongTien, t√≠nh d·ª±a tr√™n items (d√πng cho in n·∫øu c·∫ßn)
      function calculateTotalFor(gd) {
        return (gd.sanPham || []).reduce((s, it) => s + (it.donGia || it.donGia === 0 ? it.donGia : 0) * (it.soLuong || 0), 0);
      }
    </script>
  </body>
</html>